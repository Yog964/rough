<script>
  let videoElement = document.getElementById("videoElement");
  let predictionOutput = document.getElementById("predictionOutput");

  // Define your gesture labels (this should match your model's output classes)
  const gestureLabels = ["Mattar", "Chilli"];  // Example labels, modify as per your model's classes

  // Load the model (using model.json and weights.bin from GitHub)
  async function loadModel() {
    try {
      const model = await tf.loadGraphModel('https://raw.githubusercontent.com/Yog964/rough/main/model.json');  // Raw GitHub URL to model.json
      console.log('Model Loaded');
      return model;
    } catch (error) {
      console.error('Error loading model:', error);
      return null;  // Return null if model loading fails
    }
  }

  // Preprocess the frame (resize, normalize, and add batch dimension)
  function preprocess(frame) {
    const tensor = tf.browser.fromPixels(frame);
    const resized = tf.image.resizeBilinear(tensor, [300, 300]);  // Update this size if needed
    const normalized = resized.div(tf.scalar(255.0));  // Normalize to [0, 1]
    return normalized.expandDims(0);  // Add batch dimension
  }

  // Capture the current frame from the video element
  function captureFrame(video) {
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0);
    return canvas;
  }

  // Make a prediction using the loaded model
  async function predict(model) {
    if (!model) {
      console.error('Model is not loaded');
      return;  // Exit if model is not loaded
    }

    const video = videoElement;
    const frame = captureFrame(video);  // Capture the current frame

    // Preprocess the frame
    const processedFrame = preprocess(frame);

    // Make a prediction using the model
    const prediction = await model.predict(processedFrame);

    // Get the predicted class (the class with the highest probability)
    const predictedClass = prediction.argMax(1).dataSync()[0];  // Get the index of the highest probability

    console.log('Prediction:', predictedClass);
    predictionOutput.innerText = 'Predicted Gesture: ' + gestureLabels[predictedClass];  // Display the gesture label
  }

  // Start the webcam and make predictions
  async function startWebcam() {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    videoElement.srcObject = stream;  // Set the video stream as the source for the video element

    const model = await loadModel();  // Load the model

    // Continuously make predictions every second (1000ms)
    setInterval(() => {
      predict(model);
    }, 1000);
  }

  // Start the webcam and the predictions
  startWebcam();
</script>
